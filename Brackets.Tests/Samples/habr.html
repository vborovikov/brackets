<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
  <meta name="referrer" content="unsafe-url">
  <title>Бьемся с индексацией парных неравенств в PostgreSQL / Habr</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }

    /* non-breaking hyphen */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/l/font?kit=KFOlCnqEu92Fr1MmEU9vBh0_IsHAlmrO6g&skey=ee881451c540fdec&v=v29) format('woff2');
      unicode-range: U+02011;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light.css" as="style"><link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light.css" media="all">
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.5e25635d.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.02fc1736.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.a69a184a.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.6cc13d0e.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/js/7298.c8f1d73c.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.5e25635d.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.a69a184a.css">
  <script async="" src="https://mc.yandex.ru/metrika/tag.js"></script><script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/en-compiled.4411e2bb3b8d18753460aad4cf0ab8d0.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({en: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/companies\/tensor\/articles\/799225\/"},"headline":"Бьемся с индексацией парных неравенств в PostgreSQL","datePublished":"2024-03-11T15:00:05+03:00","dateModified":"2024-03-12T00:36:36+03:00","author":{"@type":"Person","name":"Боровиков Кирилл"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"м\/ф &quot;Брэк!&quot;, Гарри Бардин, 1985Я уже не раз писал, что условия с несколькими неравенствами () обычно плохо подходят для индексирования &quot;классическим&quot; btree, вызы...","url":"https:\/\/habr.com\/ru\/companies\/tensor\/articles\/799225\/#post-content-body","about":["c_tensor","h_hi","h_postgresql","h_sql","h_db_admins","f_develop","f_admin"],"image":["https:\/\/habr.com\/share\/publication\/799225\/2b1f863b987fe292069c2c9e11f09fab\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/3c0\/8f1\/fef\/3c08f1fef312ea36bbb6237e68b4a052.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/a4f\/2a3\/d09\/a4f2a3d09e1665cc05297778d23c64cb.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c81\/e08\/e3f\/c81e08e3f14cb6ce46693bb92eb16fcb.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1a2\/bfd\/e56\/1a2bfde560bf070856b845f6a5490f19.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/0e8\/8a0\/d77\/0e88a0d771141c0e310b6a832f195ca5.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/e57\/c12\/17d\/e57c1217d399da084319f9a3a5082fb9.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/919\/7d4\/42a\/9197d442a02c171fb6b9a0c7a98bb1a5.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/311\/fb6\/452\/311fb64527140d3c49239ee747a37ac0.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ad8\/105\/0d4\/ad81050d4e325a362023da234d4f0056.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/6b1\/2b1\/e33\/6b12b1e339c171ac2d831ea2d45b7894.png"]}</script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.169.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:site_name" content="Habr" data-vmid="og:site_name"><meta data-vue-meta="ssr" property="og:title" content="Бьемся с индексацией парных неравенств в PostgreSQL" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Бьемся с индексацией парных неравенств в PostgreSQL" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Бьемся с индексацией парных неравенств в PostgreSQL" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="м/ф &amp;quot;Брэк!&amp;quot;, Гарри Бардин, 1985 Я уже не раз писал , что условия с несколькими неравенствами ( &amp;lt;, &amp;lt;=, &amp;gt;=, &amp;gt; ) обычно плохо подходят для индексирования &amp;quot;классическим&amp;quot; btree , вызывают..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="м/ф &amp;quot;Брэк!&amp;quot;, Гарри Бардин, 1985 Я уже не раз писал , что условия с несколькими неравенствами ( &amp;lt;, &amp;lt;=, &amp;gt;=, &amp;gt; ) обычно плохо подходят для индексирования &amp;quot;классическим&amp;quot; btree , вызывают..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="м/ф &amp;quot;Брэк!&amp;quot;, Гарри Бардин, 1985 Я уже не раз писал , что условия с несколькими неравенствами ( &amp;lt;, &amp;lt;=, &amp;gt;=, &amp;gt; ) обычно плохо подходят для индексирования &amp;quot;классическим&amp;quot; btree , вызывают..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="м/ф &amp;quot;Брэк!&amp;quot;, Гарри Бардин, 1985 Я уже не раз писал , что условия с несколькими неравенствами ( &amp;lt;, &amp;lt;=, &amp;gt;=, &amp;gt; ) обычно плохо подходят для индексирования &amp;quot;классическим&amp;quot; btree , вызывают..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="м/ф &amp;quot;Брэк!&amp;quot;, Гарри Бардин, 1985 Я уже не раз писал , что условия с несколькими неравенствами ( &amp;lt;, &amp;lt;=, &amp;gt;=, &amp;gt; ) обычно плохо подходят для индексирования &amp;quot;классическим&amp;quot; btree , вызывают..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png?format=vk" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="799225" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2024-03-11T12:00:05.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" content="https://habr.com/ru/companies/tensor/articles/799225/" property="og:url" data-vmid="og:url"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" name="keywords" content="postgresql, sql, sql tips and tricks, индексы, gist, неравенство, explain, explain.tensor.ru">
  <link data-vue-meta="ssr" href="https://habr.com/en/rss/publications/799225/?fl=en" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/companies/tensor/articles/799225/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" rel="image_src" href="https://habrastorage.org/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png">
  <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png">
  <link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png">
  <link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png">
  <link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png">
  <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png">
  <link rel="apple-touch-icon" type="image/png" sizes="256x256" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png">
  <link rel="mask-icon" color="#77a2b6" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg">
  <link crossorigin="use-credentials" href="/manifest.webmanifest" rel="manifest">
  <script async="" src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
  <script>window.yaContextCb = window.yaContextCb || []</script>
  <script src="https://yandex.ru/ads/system/context.js" async=""></script>
<link rel="preconnect" href="https://yastatic.net/"><link rel="preconnect" href="https://avatars.mds.yandex.net/"><link rel="preconnect" href="https://mc.yandex.ru/"><link rel="preconnect" href="https://ads.adfox.ru"><link rel="preload" href="https://yastatic.net/s3/home/fonts/ys/3/text-variable-full.woff2" type="font/woff2" as="font" crossorigin="anonymous"><style id="ysTextCssRule">@font-face {
        font-family: "YS Text Variable";
        src: url("https://yastatic.net/s3/home/fonts/ys/3/text-variable-full.woff2") format("woff2");
        font-weight: 400 700;
        font-display: optional;
    }</style><script async="" crossorigin="anonymous" src="https://yastatic.net/safeframe-bundles/0.83/host.js"></script><meta http-equiv="origin-trial" content="AymqwRC7u88Y4JPvfIF2F37QKylC04248hLCdJAsh8xgOfe/dVJPV3XS3wLFca1ZMVOtnBfVjaCMTVudWM//5g4AAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9"><link rel="stylesheet" type="text/css" href="https://assets.habr.com/habr-web/css/gallery.3e8c05c3.css"><style id="syntax-highlighting-style">.ͼ4 {color: #8959a8; font-weight: bold;}
.ͼ5 {color: #4271ae;}
.ͼ6 {color: #4d4d4c;}
.ͼ7 {color: #718c00;}
.ͼ8 {color: #8e908c;}
.ͼ9 {color: #f5871f;}
.ͼa {color: #bc6060; font-weight: bold;}
.ͼb {color: #bc6060;}
.ͼc {color: #c82829;}
.ͼd {color: #718c00;}
.ͼe {color: #4d4d4c; border-bottom: 1px dotted #4d4d4c;}
.ͼf {font-weight: bold; color: #4271ae;}
.ͼg {font-weight: bold; color: #bc6060;}
.ͼh {color: #bc6060;}
.ͼi {color: #4271ae; text-decoration: underline; text-underline-position: under;}
.ͼj {font-style: italic; color: #bc6060;}
.ͼk {text-decoration: line-through; color: #bc6060;}
.ͼl {color: #8e908c;}
.ͼm {color: #4271ae;}</style></head>
<body>


<div id="app" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/en/" class="tm-header__logo tm-header__logo tm-header__logo_hl-en"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Habr</title> <use xlink:href="/img/habr-logo-en.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <!----> <a href="/en/sandbox/start/" class="tm-header__become-author-btn">
            How to become an author
          </a> <!----> <!----> <div class="tm-header-user-menu tm-header_user-menu"><a href="/en/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search"><title>Search</title> <use xlink:href="/img/megazord-v28.faec9762..svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon"><title>Settings</title> <use xlink:href="/img/megazord-v28.faec9762..svg#page-settings"></use></svg></button></div> <a href="https://habr.com/kek/v1/auth/habrahabr/?back=/en/companies/tensor/articles/799225/&amp;hl=en" rel="nofollow" class="tm-header-user-menu__item"><button type="button" class="tm-header-user-menu__login btn btn_solid btn_small">
        Login
      </button></a> <!----> <div class="v-portal" style="display: none;"></div></div></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div class="tm-base-layout__header"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><a href="/en/feed/" class="tm-main-menu__item">
        My feed
      </a> <a href="/en/articles/" class="tm-main-menu__item">
        All streams
      </a> <a href="/en/flows/develop/" class="tm-main-menu__item">
          Development
        </a><a href="/en/flows/admin/" class="tm-main-menu__item">
          Admin
        </a><a href="/en/flows/design/" class="tm-main-menu__item">
          Design
        </a><a href="/en/flows/management/" class="tm-main-menu__item">
          Management
        </a><a href="/en/flows/marketing/" class="tm-main-menu__item">
          Marketing
        </a><a href="/en/flows/popsci/" class="tm-main-menu__item">
          PopSci
        </a></nav></div></div> <!----></div></div></div> <!----> <div class="tm-page-width tm-page-width_no-padding"></div> <main class="tm-layout__container"><div hl="en" companyname="tensor" data-async-called="true" class="tm-page"><div class="tm-page-width tm-page-width_no-padding"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><!----> <div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__icon pull-down__arrow"><title>Pull to refresh</title> <use xlink:href="/img/megazord-v28.faec9762..svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><!----> <!----> <!----> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet tm-article-snippet"> <div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/en/users/Kilor/" title="Kilor" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="32" src="//habrastorage.org/r/w64/getpro/habr/avatars/b09/2c9/17e/b092c917e7f287b93481ae40ee4a2d43.png" width="32" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user tm-user-info__user_appearance-default"><a href="/en/users/Kilor/" class="tm-user-info__username">
      Kilor
      <!----></a> <span class="tm-article-datetime-published"><time datetime="2024-03-11T12:00:05.000Z" title="2024-03-11, 17:00"> Mar  11  at 17:00</time></span></span></span></div> <!----></div> <h1 lang="ru" class="tm-title tm-title_h1"><span>Бьемся с индексацией парных неравенств в PostgreSQL</span></h1> <div class="tm-article-snippet__stats"><div class="tm-article-complexity tm-article-complexity_complexity-medium"><span class="tm-svg-icon__wrapper tm-article-complexity__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Level of difficulty</title> <use xlink:href="/img/megazord-v28.faec9762..svg#complexity-medium"></use></svg></span> <span class="tm-article-complexity__label">
    Medium
  </span></div> <div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Reading time</title> <use xlink:href="/img/megazord-v28.faec9762..svg#clock"></use></svg></span> <span class="tm-article-reading-time__label">
    6 min
  </span></div> <span class="tm-icon-counter tm-data-icons__item"><svg height="24" width="24" class="tm-svg-img tm-icon-counter__icon"><title>Views</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.2K</span></span></div> <div class="tm-publication-hubs__container"><div class="tm-publication-hubs"><span class="tm-publication-hub__link-container"><a href="/en/companies/tensor/articles/" class="router-link-active tm-publication-hub__link"><span>Тензор corporate blog</span> <!----></a></span><span class="tm-publication-hub__link-container"><a href="/en/hubs/hi/" class="tm-publication-hub__link"><span>High performance</span> <span title="Core hub" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-publication-hub__link-container"><a href="/en/hubs/postgresql/" class="tm-publication-hub__link"><span>PostgreSQL</span> <span title="Core hub" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-publication-hub__link-container"><a href="/en/hubs/sql/" class="tm-publication-hub__link"><span>SQL</span> <span title="Core hub" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-publication-hub__link-container"><a href="/en/hubs/db_admins/" class="tm-publication-hub__link"><span>Database Administration</span> <span title="Core hub" class="tm-article-snippet__profiled-hub">*</span></a></span></div></div> <div class="tm-article-labels"><div class="tm-article-labels__container"><div class="tm-publication-label tm-publication-label_variant-tutorial"><span>
    Tutorial
  </span></div> </div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div></div> <div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png" alt="м/ф &quot;Брэк!&quot;, Гарри Бардин, 1985" title="м/ф &quot;Брэк!&quot;, Гарри Бардин, 1985" width="800" height="600" data-src="https://habrastorage.org/getpro/habr/upload_files/3c0/8f1/fef/3c08f1fef312ea36bbb6237e68b4a052.png"><div><figcaption>м/ф "Брэк!", Гарри Бардин, 1985</figcaption></div></figure><p>Я уже <a href="https://habr.com/ru/post/488104/">не раз писал</a>, что <strong>условия с несколькими неравенствами</strong> (<code>&lt;, &lt;=, &gt;=, &gt;</code>) обычно плохо подходят для индексирования "классическим" <code>btree</code>, вызывают "тормоза", и необходимо придумывать различные <a href="https://habr.com/ru/post/526624/">нетривиальные подходы</a> в PostgreSQL, чтобы добиться хорошей производительности подобного запроса.</p><p>В этой статье мы не только рассмотрим способы решения подобных задач "в общем виде", но и покажем, как нам удалось автоматизировать их решение в рамках <a href="https://habr.com/ru/post/659889/">функционала рекомендаций индексов</a> нашего <strong>сервиса анализа планов</strong> <a href="https://explain.tensor.ru/">explain.tensor.ru</a> и его новых возможностях.</p><p>Сразу договоримся, что во всех последующих примерах <code>x &lt;= y</code>, а <code>exprA &lt;= exprB</code> - потому что если это вдруг не так, то значения можно "поменять местами".</p><p>А тестировать наши запросы мы будем на вот такой таблице с "интервалами":</p><pre><code class="sql"><span class="ͼ4">CREATE</span> <span class="ͼ4">TABLE</span> rng <span class="ͼ4">AS</span><br><span class="ͼ4">SELECT</span><br>  x<br>, x <span class="ͼ6">+</span> (random() <span class="ͼ6">*</span> <span class="ͼ9">10</span>)::<span class="ͼ4">integer</span> y<br><span class="ͼ4">FROM</span><br>  (<br>    <span class="ͼ4">SELECT</span><br>      now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> (random() <span class="ͼ6">*</span> <span class="ͼ9">1000</span>)::<span class="ͼ4">integer</span> x<br>    <span class="ͼ4">FROM</span><br>      generate_series(<span class="ͼ9">1</span>, <span class="ͼ9">1e6</span>)<br>  ) T;</code></pre><h2>x &gt;= expr и вывод типов</h2><p>Начнем, конечно, с самого простого варианта - проверки принадлежности значения поля "лучу":</p><pre><code class="sql">EXPLAIN (ANALYZE, BUFFERS, SUMMARY OFF)<br><span class="ͼ4">SELECT</span><br>  <span class="ͼ6">*</span><br><span class="ͼ4">FROM</span><br>  rng<br><span class="ͼ4">WHERE</span><br>  x <span class="ͼ6">&gt;=</span> now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> <span class="ͼ9">1</span>;</code></pre><p>Получим примерно вот такой план:</p><pre><code>Gather  (cost=1000.00..13956.63 rows=1983 width=8) (actual time=0.781..116.993 rows=1459 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  Buffers: shared hit=2400 read=2025
  -&gt;  Parallel Seq Scan on rng  (cost=0.00..12758.33 rows=826 width=8) (actual time=0.325..85.305 rows=486 loops=3)
        Filter: (x &gt;= ((now())::date - 1))
        Rows Removed by Filter: 332847
        Buffers: shared hit=2400 read=2025</code></pre><p>Если мы отправим <a href="https://explain.tensor.ru/archive/explain/b5d3acd52f1f5c0c43d0fb01b860126a:0:2024-03-11">этот план</a> к нам на сервис, то сразу увидим рекомендацию около узла <code>Parallel Seq Scan</code>:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/a4f/2a3/d09/a4f2a3d09e1665cc05297778d23c64cb.png" alt="План с рекомендацией" title="План с рекомендацией" width="1209" height="260" data-src="https://habrastorage.org/getpro/habr/upload_files/a4f/2a3/d09/a4f2a3d09e1665cc05297778d23c64cb.png"><div><figcaption>План с рекомендацией</figcaption></div></figure><p>Оно и понятно - когда 99% почитанных записей отбрасывается по условию, гораздо эффективнее создать подходящий индекс, чем читать лишнее, и тут можно использовать даже обычный <code>btree</code>:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/c81/e08/e3f/c81e08e3f14cb6ce46693bb92eb16fcb.png" alt="Рекомендация по созданию индекса с выведенным типом" title="Рекомендация по созданию индекса с выведенным типом" width="742" height="323" data-src="https://habrastorage.org/getpro/habr/upload_files/c81/e08/e3f/c81e08e3f14cb6ce46693bb92eb16fcb.png"><div><figcaption>Рекомендация по созданию индекса с выведенным типом</figcaption></div></figure><p>Обратите внимание, что несмотря на использование в правой части неравенства не константы заранее известного типа, а выражения, его <strong>тип все равно удалось вывести</strong> как <code>date - integer -&gt; date</code>  и соотнести с типом поля.</p><p>Типы выводятся на всю необходимую глубину и учитывает типы, возвращаемые встроенными функциями, поэтому что-то вроде <code>current_date - '1 day'::interval</code> тоже будет нормально распознано как <code>date - interval -&gt; timestamp</code>.</p><h2>x &gt;= exprA AND x &lt;= exprB (x BETWEEN exprA AND exprB)</h2><p>Следующее неравенство тоже вполне покрывается возможностями <code>btree</code>, поскольку задается <strong>относительно лишь одного столбца</strong>:</p><pre><code class="sql">EXPLAIN (ANALYZE, BUFFERS, SUMMARY OFF)<br><span class="ͼ4">SELECT</span><br>  <span class="ͼ6">*</span><br><span class="ͼ4">FROM</span><br>  rng<br><span class="ͼ4">WHERE</span><br>  x <span class="ͼ4">BETWEEN</span> now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> <span class="ͼ9">7</span> <span class="ͼ4">AND</span> now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> <span class="ͼ9">1</span>;</code></pre><p>Здесь <a href="https://explain.tensor.ru/archive/explain/7d74b01ad03fe062ecea6b425043bd4b:0:2024-03-11#pane-d2d9ce665f66ae49556b47436a514c0f">наши рекомендации</a> остаются прежними, меняется лишь набор операторов у поля <code>x</code> - было <code>(&gt;=)</code>, стало <code>(&gt;=,&lt;=)</code>:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/1a2/bfd/e56/1a2bfde560bf070856b845f6a5490f19.png" alt="Индекс, рекомендованный для диапазона" title="Индекс, рекомендованный для диапазона" width="745" height="323" data-src="https://habrastorage.org/getpro/habr/upload_files/1a2/bfd/e56/1a2bfde560bf070856b845f6a5490f19.png"><div><figcaption>Индекс, рекомендованный для диапазона</figcaption></div></figure><p>В данном примере, как и в предыдущем, вместо <code>&gt;=</code> и <code>&lt;=</code> могут быть "просто" <code>&gt;</code> и <code>&lt;</code> - это ничего не изменит.</p><p>А что если условие написано не через <code>BETWEEN</code>, а "вручную", где столбец вдруг оказался справа?..</p><pre><code class="sql">EXPLAIN (ANALYZE, BUFFERS, SUMMARY OFF)<br><span class="ͼ4">SELECT</span><br>  <span class="ͼ6">*</span><br><span class="ͼ4">FROM</span><br>  rng<br><span class="ͼ4">WHERE</span><br>  x <span class="ͼ6">&gt;=</span> now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> <span class="ͼ9">2</span> <span class="ͼ4">AND</span> now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> <span class="ͼ9">1</span> <span class="ͼ6">&gt;=</span> x;</code></pre><p>Операторы неравенства все равно <a href="https://explain.tensor.ru/archive/explain/82898fa2bd438c02328662142e97021b:0:2024-03-11#pane-d2d9ce665f66ae49556b47436a514c0f">будут определены правильно</a>, "развернувшись" в нужную сторону относительно столбца <code>x (&gt;=,&lt;=)</code>:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/0e8/8a0/d77/0e88a0d771141c0e310b6a832f195ca5.png" alt="Применяемые к столбцу операторы &quot;разворачиваются&quot;" title="Применяемые к столбцу операторы &quot;разворачиваются&quot;" width="746" height="324" data-src="https://habrastorage.org/getpro/habr/upload_files/0e8/8a0/d77/0e88a0d771141c0e310b6a832f195ca5.png"><div><figcaption>Применяемые к столбцу операторы "разворачиваются"</figcaption></div></figure><h2>Неравенства с одним выражением</h2><h4>x &lt;= expr AND expr &lt;= y</h4><p>Но если все так замечательно решает <code>btree</code>, то разве есть ситуации, когда он не справляется?.. Есть, и их гораздо больше!</p><p>Как только у нас возникает <strong>неравенство относительно второго столбца</strong>, например, если мы "вывернем" предыдущее, и будем проверять не принадлежность столбца отрезку с границами значений, а значения - отрезку с границами столбцов:</p><pre><code class="sql">EXPLAIN (ANALYZE, BUFFERS, SUMMARY OFF)<br><span class="ͼ4">SELECT</span><br>  <span class="ͼ6">*</span><br><span class="ͼ4">FROM</span><br>  rng<br><span class="ͼ4">WHERE</span><br>  x <span class="ͼ6">&lt;=</span> now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> <span class="ͼ9">7</span> <span class="ͼ4">AND</span> now()::<span class="ͼ4">date</span> <span class="ͼ6">-</span> <span class="ͼ9">7</span> <span class="ͼ6">&lt;=</span> y;</code></pre><p>Как решать подобные задачи (с помощью <a href="https://postgrespro.ru/docs/postgresql/16/rangetypes#RANGETYPES-INDEXING">gist-индекса</a>), я подробно рассказывал в статье <a href="https://habr.com/ru/post/526624/">"PostgreSQL Antipatterns: работаем с отрезками в «кровавом энтерпрайзе»"</a>, но останавливался только лишь на одном этом варианте - проверки принадлежности диапазону:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e57/c12/17d/e57c1217d399da084319f9a3a5082fb9.png" alt="gist-индекс для индексирования вхождения в диапазон" title="gist-индекс для индексирования вхождения в диапазон" width="746" height="324" data-src="https://habrastorage.org/getpro/habr/upload_files/e57/c12/17d/e57c1217d399da084319f9a3a5082fb9.png"><div><figcaption>gist-индекс для индексирования вхождения в диапазон</figcaption></div></figure><p>Здесь не только <a href="https://explain.tensor.ru/archive/explain/8aaf73e7e66e239dc2cefb37b120bc40:0:2024-03-11#pane-d2d9ce665f66ae49556b47436a514c0f">удалось определить типы столбцов</a> (<code>date</code>), но и за счет использования одного и того же выражения (<code>now()::date - 7</code>) в обоих неравенствах удалось сделать вывод о возможности использования оператора проверки принадлежности отрезку (<code>@&gt;</code>).</p><p>Понятно, что все описываемые ниже способы допустимы лишь для выражений, чье <strong>значение неизменно при вычислении запроса</strong>, и для всяких <code>random()</code> не подойдут - то есть оба одинаковых упоминания дают один и тот же результат при вычислении.</p><p>То есть эквивалентное целевое условие для возможности использования такого индекса должно выглядеть как <code>daterange(x, y, '[]') @&gt; (now()::date - 7)</code>.</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/919/7d4/42a/9197d442a02c171fb6b9a0c7a98bb1a5.png" alt="< AND >  =>  range @> expr" title="< AND >  =>  range @> expr" width="688" height="181" data-src="https://habrastorage.org/getpro/habr/upload_files/919/7d4/42a/9197d442a02c171fb6b9a0c7a98bb1a5.png"><div><figcaption><code>&lt; AND &gt;  =&gt;  range @&gt; expr</code></figcaption></div></figure><p>Однако, это <code>(&lt;=, &gt;=)</code> всего лишь одна, хотя и наиболее частая, из возможных комбинаций операторов для пары столбцов <code>(x, y)</code> - а как быть с другими?..</p><p>Для начала, заметим, что условие <code>&lt;=/&lt;</code> определяет <a href="https://postgrespro.ru/docs/postgresql/16/rangetypes#RANGETYPES-IO">включение/исключение крайней точки интервала</a> - <code>[</code> или <code>(</code>, и больше не влияет ни на что. А вот комбинация неравенств - влияет!</p><p>Попробуем выразить пары неравенств относительно одного выражения графически и посмотреть, каким интервальным оператором она может быть заменена.</p><h4>x &gt; expr AND y &gt; expr / x &lt; expr AND y &lt; expr</h4><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/311/fb6/452/311fb64527140d3c49239ee747a37ac0.png" alt="> AND >  =>  range &amp;> range(expr, expr, '[]')" title="> AND >  =>  range &amp;> range(expr, expr, '[]')" width="962" height="194" data-src="https://habrastorage.org/getpro/habr/upload_files/311/fb6/452/311fb64527140d3c49239ee747a37ac0.png"><div><figcaption><code>&gt; AND &gt;  =&gt;  range &amp;&gt; range(expr, expr, '[]')</code></figcaption></div></figure><p>Пару "однонаправленных" неравенств нам помогут проиндексировать <a href="https://postgrespro.ru/docs/postgresql/16/functions-range#RANGE-OPERATORS-TABLE">диапазонные операторы</a> <code>&amp;&gt;</code> и <code>&amp;&lt;</code> ("находится справа/слева"). Но, поскольку по обе стороны должен быть интервал, наше <strong>"точечное" значение придется преобразовать в интервал</strong> из единственной точки <code>range(expr, expr, '[]')</code>.</p><h3>x &lt; expr AND y &gt; expr</h3><p>Понятно, что если мы заведомо знаем, что <code>y &gt; x</code>, то это условие будет эквивалентно <code>FALSE</code>. Но вряд ли кто-то осознанно хотел найти "ничего" - поэтому при рекомендации мы "меняем местами" <code>x</code> и <code>y</code> и "сводим задачу к предыдущей": <code>range(y, x, '()') @&gt; expr</code>.</p><h4>Итого</h4><pre><code class="sql">(x <span class="ͼ6">&gt;</span> expr) <span class="ͼ4">AND</span> (y <span class="ͼ6">&gt;</span> expr)  <span class="ͼ6">=&gt;</span>  range(x, y, <span class="ͼ7">'()'</span>) <span class="ͼ6">&amp;&gt;</span> range(expr, expr, <span class="ͼ7">'[]'</span>)<br>(x <span class="ͼ6">&gt;</span> expr) <span class="ͼ4">AND</span> (y <span class="ͼ6">&lt;</span> expr)  <span class="ͼ6">=&gt;</span>  range(y, x, <span class="ͼ7">'()'</span>) @<span class="ͼ6">&gt;</span> expr<br>(x <span class="ͼ6">&lt;</span> expr) <span class="ͼ4">AND</span> (y <span class="ͼ6">&gt;</span> expr)  <span class="ͼ6">=&gt;</span>  range(x, y, <span class="ͼ7">'()'</span>) @<span class="ͼ6">&gt;</span> expr<br>(x <span class="ͼ6">&lt;</span> expr) <span class="ͼ4">AND</span> (y <span class="ͼ6">&lt;</span> expr)  <span class="ͼ6">=&gt;</span>  range(x, y, <span class="ͼ7">'()'</span>) <span class="ͼ6">&amp;&lt;</span> range(expr, expr, <span class="ͼ7">'[]'</span>)</code></pre><h2>Неравенства с разными константами</h2><p>Теперь рассмотрим случай, когда значения по другую сторону от столбцов неодинаковы, но все же представляют из себя <strong>некоторые константы</strong>, про которые мы легко можем сказать, какая из них больше/меньше.</p><p>Договоримся, что <code>constA &lt; constB</code>, иначе "поменяем местами" <code>x</code> и <code>y</code> - тогда мы всегда можем создать диапазон соответствующего типа <code>range(ca, cb, '[]')</code>:</p><pre><code class="sql">EXPLAIN (ANALYZE, BUFFERS, SUMMARY OFF)<br><span class="ͼ4">SELECT</span><br>  <span class="ͼ6">*</span><br><span class="ͼ4">FROM</span><br>  rng<br><span class="ͼ4">WHERE</span><br>  x <span class="ͼ6">&gt;=</span> <span class="ͼ7">'2024-01-01'</span> <span class="ͼ4">AND</span> y <span class="ͼ6">&lt;</span> <span class="ͼ7">'2024-02-01'</span>;</code></pre><p>Собственно, задача снова <a href="https://explain.tensor.ru/archive/explain/badf6411defd58d8c0511eba28f3ae55:0:2024-03-11#pane-d2d9ce665f66ae49556b47436a514c0f">сведена к предыдущей</a> за единственным исключением - вместо оператора проверки принадлежности диапазону (<code>@&gt;</code>) необходимо использовать оператор пересечения <code>(&amp;&amp;</code>):</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/ad8/105/0d4/ad81050d4e325a362023da234d4f0056.png" alt="(x >= ca) AND (y < cb)  => range(x, y, '[)') &amp;&amp; range(ca, cb, '[]')" title="(x >= ca) AND (y < cb)  => range(x, y, '[)') &amp;&amp; range(ca, cb, '[]')" width="745" height="324" data-src="https://habrastorage.org/getpro/habr/upload_files/ad8/105/0d4/ad81050d4e325a362023da234d4f0056.png"><div><figcaption><code>(x &gt;= ca) AND (y &lt; cb)  =&gt; range(x, y, '[)') &amp;&amp; range(ca, cb, '[]')</code></figcaption></div></figure><h4>Итого</h4><pre><code class="sql">(x <span class="ͼ6">&gt;</span> ca) <span class="ͼ4">AND</span> (y <span class="ͼ6">&gt;</span> cb)  <span class="ͼ6">=&gt;</span> range(x, y, <span class="ͼ7">'()'</span>) <span class="ͼ6">&amp;&gt;</span> range(ca, cb, <span class="ͼ7">'[]'</span>)<br>(x <span class="ͼ6">&gt;</span> ca) <span class="ͼ4">AND</span> (y <span class="ͼ6">&lt;</span> cb)  <span class="ͼ6">=&gt;</span> range(x, y, <span class="ͼ7">'()'</span>) <span class="ͼ6">&amp;&amp;</span> range(ca, cb, <span class="ͼ7">'[]'</span>)<br>(x <span class="ͼ6">&lt;</span> ca) <span class="ͼ4">AND</span> (y <span class="ͼ6">&gt;</span> cb)  <span class="ͼ6">=&gt;</span> range(x, y, <span class="ͼ7">'()'</span>) @<span class="ͼ6">&gt;</span> range(ca, cb, <span class="ͼ7">'[]'</span>)<br>(x <span class="ͼ6">&lt;</span> ca) <span class="ͼ4">AND</span> (y <span class="ͼ6">&lt;</span> cb)  <span class="ͼ6">=&gt;</span> range(x, y, <span class="ͼ7">'()'</span>) <span class="ͼ6">&amp;&lt;</span> range(ca, cb, <span class="ͼ7">'[]'</span>)</code></pre><h2>Неравенства с разными выражениями</h2><p>Поскольку вычисление самих значений весьма нетривиально, то рекомендовать тут можно только самый типовой вариант с оператором <code>&amp;&amp;</code>.</p><p>Однако, стоит быть внимательными с созданием необходимого диапазона - не все из них PostgreSQL готов "переварить":</p><pre><code class="sql"><span class="ͼ4">SELECT</span> tsrange(<br>  current_date <span class="ͼ6">-</span> <span class="ͼ7">'1 day'</span>::interval<br>, current_date <span class="ͼ6">-</span> <span class="ͼ7">'100000 sec'</span>::interval<br>, <span class="ͼ7">'[]'</span><br>);<br><span class="ͼ8">-- ERROR:  range lower bound must be less than or equal to range upper bound</span></code></pre><p>Собственно, на этом и все! Практически все плохо индексируемые парные неравенства могут быть нормально проиндексированы с помощью <a href="https://postgrespro.ru/docs/postgresql/16/rangetypes#RANGETYPES-BUILTIN">диапазонных типов</a>. Однако, пока их всего 6:</p><ul><li><p><code>int4range</code>&nbsp;(<code>integer</code>)</p></li><li><p><code>int8range</code>&nbsp;(<code>bigint</code>)</p></li><li><p><code>numrange</code>&nbsp;(<code>numeric</code>)</p></li><li><p><code>tsrange</code>&nbsp;(<code>timestamp without time zone</code>)</p></li><li><p><code>tstzrange</code>&nbsp;(<code>timestamp with time zone</code>)</p></li><li><p><code>daterange</code>&nbsp;(<code>date</code>)</p></li></ul><p>Поэтому провернуть подобный фокус в <code>double precision</code> или <code>varchar</code> - не выйдет. Но там есть свои способы, о которых - в другой раз.</p><hr><h2>А что еще новенького?..</h2><p>Помимо подсказок диапазонных индексов мы еще поправили <strong>подсказки для индексируемых массивов</strong> - например, базово их может индексировать для оператора включения (<code>@&gt;</code>) только <code>gin</code>-тип индексов, но если у нас поле типа <code>integer[]</code>, то с расширением <a href="https://postgrespro.ru/docs/postgresql/16/intarray#INTARRAY-INDEX">intarray</a> можно использовать и <code>gist</code> с разными нестандартными опциями.</p><p>Поддержали правильное указание класса операторов при <code>gist</code>-индексации <code>inet</code>-полей:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/6b1/2b1/e33/6b12b1e339c171ac2d831ea2d45b7894.png" alt="gist(inet_ops)" title="gist(inet_ops)" width="747" height="222" data-src="https://habrastorage.org/getpro/habr/upload_files/6b1/2b1/e33/6b12b1e339c171ac2d831ea2d45b7894.png"><div><figcaption>gist(inet_ops)</figcaption></div></figure><p>Это вот та самая оговорка в <a href="https://postgrespro.ru/docs/postgresql/16/gist-builtin-opclasses">документации</a>:</p><blockquote><p>По историческим причинам класс операторов&nbsp;<code>inet_ops</code>&nbsp;не является классом по умолчанию для типов&nbsp;<code>inet</code>&nbsp;и&nbsp;<code>cidr</code>. Чтобы использовать его, укажите имя класса в&nbsp;<code>CREATE INDEX</code>, например:</p><p><code>CREATE INDEX ON my_table USING GIST (my_inet_column inet_ops);</code></p></blockquote><hr><p>А еще у нашего сервиса появились <a href="https://explain.tensor.ru/downloads-plugins/">плагины для различных IDE</a> (<em>IntelliJ, Eclipse, DBeaver, VSCode, Sublime</em>), о разработке которых была опубликована <a href="https://habr.com/ru/companies/tensor/articles/782150/">пара</a> <a href="https://habr.com/ru/companies/tensor/articles/789734/">статей</a>.</p><p></p></div></div></div> <div class="v-portal" style="display: none;"></div> <div class="v-portal" style="display: none;"></div></div> <div aria-hidden="true" role="dialog" tabindex="-1" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><span class="tm-svg-icon__wrapper pswp__button pswp__button--close"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Close</title> <use xlink:href="/img/megazord-v28.faec9762..svg#close"></use></svg></span> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <button class="pswp__button pswp__button--arrow--left"><svg viewBox="0 0 24 24" class="pswp__button-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.707 4.293a1 1 0 010 1.414L9.414 12l6.293 6.293a1 1 0 01-1.414 1.414l-7-7a1 1 0 010-1.414l7-7a1 1 0 011.414 0z"></path></svg></button> <button class="pswp__button pswp__button--arrow--right"><svg viewBox="0 0 24 24" class="pswp__button-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.707 4.293a1 1 0 010 1.414L9.414 12l6.293 6.293a1 1 0 01-1.414 1.414l-7-7a1 1 0 010-1.414l7-7a1 1 0 011.414 0z"></path></svg></button></div></div></div> <!----></div> <!----> <div class="tm-article-presenter__meta"><div class="tm-article-presenter__meta-list tm-separated-list"><span class="tm-separated-list__title">Tags:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpostgresql%5D" class="tm-tags-list__link">postgresql</a></li><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsql%5D" class="tm-tags-list__link">sql</a></li><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsql%20tips%20and%20tricks%5D" class="tm-tags-list__link">sql tips and tricks</a></li><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D1%8B%5D" class="tm-tags-list__link">индексы</a></li><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgist%5D" class="tm-tags-list__link">gist</a></li><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BD%D0%B5%D1%80%D0%B0%D0%B2%D0%B5%D0%BD%D1%81%D1%82%D0%B2%D0%BE%5D" class="tm-tags-list__link">неравенство</a></li><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5Bexplain%5D" class="tm-tags-list__link">explain</a></li><li class="tm-separated-list__item"><a href="/en/search/?target_type=posts&amp;order=relevance&amp;q=%5Bexplain.tensor.ru%5D" class="tm-tags-list__link">explain.tensor.ru</a></li> <!----></ul></div> <div class="tm-article-presenter__meta-list tm-separated-list"><span class="tm-separated-list__title">Hubs:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/en/companies/tensor/articles/" class="tm-hubs-list__link router-link-active">Тензор corporate blog</a></li><li class="tm-separated-list__item"><a href="/en/hubs/hi/" class="tm-hubs-list__link">High performance</a></li><li class="tm-separated-list__item"><a href="/en/hubs/postgresql/" class="tm-hubs-list__link">PostgreSQL</a></li><li class="tm-separated-list__item"><a href="/en/hubs/sql/" class="tm-hubs-list__link">SQL</a></li><li class="tm-separated-list__item"><a href="/en/hubs/db_admins/" class="tm-hubs-list__link">Database Administration</a></li> <!----></ul></div></div> <!----></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div title="Total votes 14: ↑14 and ↓0" class="tm-votes-lever tm-article-rating__votes-switcher tm-votes-lever tm-votes-lever_appearance-article"><button title="Like" type="button" class="tm-votes-lever__button"><svg height="24" width="24" class="tm-svg-img tm-votes-lever__icon"><title>Voting</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-vote"></use></svg></button> <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-article"><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_positive">
          +14
        </span></span></div> <button title="Dislike" type="button" class="tm-votes-lever__button"><svg height="24" width="24" class="tm-svg-img tm-votes-lever__icon tm-votes-lever__icon_arrow-down"><title>Voting</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-vote"></use></svg></button></div> <div class="v-portal" style="display:none;"></div> <!----></div> <!----> <!----> <button title="Add to bookmarks" type="button" class="bookmarks-button tm-data-icons__item"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Add to bookmarks</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-favorite"></use></svg></span> <span title="Users added publication to bookmarks" class="bookmarks-button__counter">
    35
  </span></button> <div title="Share" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button> <div class="v-portal" style="display:none;"></div></div> <div title="Read comments" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/en/companies/tensor/articles/799225/comments/" class="tm-article-comments-counter-link__link"><svg height="24" width="24" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Comments</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      2
    </span></a> <!----></div> <!----> <div class="v-portal" style="display:none;"></div></div></div></div>  <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><div class="tm-editoral-subscription"><span class="tm-svg-icon__wrapper tm-editoral-subscription__close"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Close</title> <use xlink:href="/img/megazord-v28.faec9762..svg#close"></use></svg></span> <h3 class="tm-editoral-subscription__title">
    Editorial Digest
  </h3> <p class="tm-editoral-subscription__description">
    We email you the best articles monthly
  </p> <form method="GET" class="tm-editoral-subscription__form"><div class="tm-input-text-decorated tm-editoral-subscription__input tm-input-text-decorated_has-label-after" name="email" placeholder="Email address" type="email"><!----> <input name="email" placeholder="Email address" type="email" class="tm-input-text-decorated__input"> <div class="tm-input-text-decorated__label tm-input-text-decorated__label_after"><button type="submit" class="tm-editoral-subscription__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" clip-rule="evenodd" d="M19.707 11.293a1 1 0 010 1.414l-5.5 5.5a1 1 0 01-1.414-1.414L16.586 13H5a1 1 0 110-2h11.586l-3.793-3.793a1 1 0 011.414-1.414l5.5 5.5z"></path></svg></button></div></div> <!----></form></div> <section class="tm-block tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/en/companies/tensor/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" height="40" src="//habrastorage.org/getpro/habr/company/965/5db/1ba/9655db1baf250228edff7ae09354b3b1.png" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/en/companies/tensor/profile/" class="tm-company-snippet__title">Тензор</a> <div class="tm-company-snippet__description">Разработчик системы СБИС</div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="https://sbis.ru/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Website
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/en/users/Kilor/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/b09/2c9/17e/b092c917e7f287b93481ae40ee4a2d43.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 193 votes " class="tm-counter-container tm-karma tm-karma"><div class="tm-counter-container__header"><div class="tm-karma__votes tm-karma__votes_positive">
      177
    </div></div> <div class="tm-counter-container__footer"><div class="tm-karma__text">
      Karma
    </div> <div class="v-portal" style="display:none;"></div></div></div> <div title="User`s rating" class="tm-counter-container"><div class="tm-counter-container__header"> <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----> <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating"><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating">
          14
        </span></span></div> <!----></div></div> <div class="tm-counter-container__footer"><span class="tm-rating__text tm-rating__text">
      Rating
    </span></div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name tm-user-card__name_variant-article">Боровиков Кирилл</span> <a href="/en/users/Kilor/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article">
          @Kilor
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info tm-user-card__short-info_variant-article">Архитектура ИС: PostgreSQL, Node.js и highload</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://explain.tensor.ru/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Website
    </a><a href="https://sbis.ru/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Website
    </a></div></div></div> <!----></section> <!----> <!----> <div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/en/companies/tensor/articles/799225/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="24" width="24" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Comments</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Comments 2 
    </span></a> <!----></div></div></div>  <section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Articles</h2> </div> <!----></header> <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><div class="tm-tabs tm-tabs"><div class=""><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim">
        Top of the day
      </button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_slim">
        Similar articles
      </button></span></div> <!----></div> <div class="similar-and-daily__tab-view"><div class="placeholder-wrapper"><!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <div class="tm-placeholder-article-cards"><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div></div> <!----> <!----> <!----> <!----> <!----></div> <!----></div></div> <!----></section> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><!----></div></div></div></div></main> <!----></div> <!----> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><div class="tm-footer__title"><a href="/en/" class="tm-svg-icon__wrapper tm-footer__title-link"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Habr</title> <use xlink:href="/img/habr-logo-en.svg#logo"></use></svg></a></div> <div class="tm-footer__social"><a href="https://www.facebook.com/habr.eng" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_eng" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://t.me/habr_eng" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a></div> <div class="v-portal" style="display:none;"></div> <button class="tm-footer__link"><svg height="16" width="16" class="tm-svg-img tm-footer__icon"><title>Language</title> <use xlink:href="/img/megazord-v28.faec9762..svg#lang"></use></svg>
        Language settings
      </button> <a href="/en/feedback/" class="tm-footer__link">
        Support
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2024, </span> <span class="tm-copyright__name"><a href="https://company.habr.com/en/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a></span></span></div></div></div></div> <!----></div> <div class="vue-portal-target"><!----><!----></div></div>

<script src="https://assets.habr.com/habr-web/js/chunk-vendors.02fc1736.js" defer=""></script><script src="https://assets.habr.com/habr-web/js/7298.c8f1d73c.js" defer=""></script><script src="https://assets.habr.com/habr-web/js/app.6cc13d0e.js" defer=""></script>



    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  
  <script type="text/javascript">
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
<script src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true"></script><div id="K9Jn4i4Yhz" style="display: none;"></div>


<div><div><div class="Vue-Toastification__container top-left"></div></div><div><div class="Vue-Toastification__container top-center"></div></div><div><div class="Vue-Toastification__container top-right"></div></div><div><div class="Vue-Toastification__container bottom-left"></div></div><div><div class="Vue-Toastification__container bottom-center"></div></div><div><div class="Vue-Toastification__container bottom-right"></div></div></div></body></html>
